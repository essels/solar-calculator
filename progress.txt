# SolarQuote UK - Ralph Loop Progress Tracker
# ═══════════════════════════════════════════════════════════════════
# Format: [TIMESTAMP] [ITERATION] [FEATURE] [STATUS] [NOTES]
# ═══════════════════════════════════════════════════════════════════

## Project Initialisation
[2026-01-08T00:00:00Z] [INIT] [SCAFFOLD] [CREATED] Project scaffold created with Ralph Loop structure

## Subagent Response Cache
# Store successful subagent responses here to avoid repeated queries
# Format: ### SUBAGENT: [QUERY_TYPE] - [DATE]

### SUBAGENT: UK_ENERGY_PRICES - 2026-01-08
```json
{
  "electricityRatePence": 27.69,
  "segExportRatePence": 15.0,
  "standingChargePence": 54.7,
  "source": "Ofgem Price Cap Q1 2026",
  "lastVerified": "2026-01-08"
}
```

### SUBAGENT: PVGIS_API - 2026-01-08
```
Endpoint: https://re.jrc.ec.europa.eu/api/v5_3/PVcalc
Method: GET
Required params: lat, lon, peakpower, loss
Optional: angle, aspect, outputformat (json)
Rate limit: 30 requests/second
Response: JSON with monthly/annual values
```

### SUBAGENT: POSTCODES_IO - 2026-01-08
```
Endpoint: https://api.postcodes.io/postcodes/{postcode}
Method: GET
No authentication required
Returns: latitude, longitude, region, admin_district
Validation: UK postcode format regex
```

## Iteration Log
# ═══════════════════════════════════════════════════════════════════

# [TIMESTAMP] [ITER-N] [FEATURE-ID] [STATUS] [NOTES]
# STATUS: STARTED | IN_PROGRESS | COMPLETE | BLOCKED | SKIPPED

# ═══════════════════════════════════════════════════════════════════
# Session entries will be appended below
# ═══════════════════════════════════════════════════════════════════

[2026-01-08T11:45:00Z] [ITER-1] [SETUP-001] [COMPLETE] Next.js 14 project initialized
- Used create-next-app@latest with --typescript --tailwind --eslint --app --src-dir
- Preserved existing scaffold files (calculations.ts, constants.ts, solar.ts types)
- Configured UK-appropriate green/solar colour palette in globals.css
- Path aliases @/* configured in tsconfig.json
- npm run dev starts on localhost:3000, TypeScript compiles without errors
- Subagent used: Haiku for setup verification recommendations

[2026-01-08T11:55:00Z] [ITER-1] [SETUP-002] [COMPLETE] ESLint, Prettier, and Git hooks configured
- ESLint configured with eslint-config-next/core-web-vitals and typescript rules
- Prettier configured with single quotes, trailing commas, 100 char line width
- Husky pre-commit hook runs lint-staged
- lint-staged runs eslint --fix and prettier --write on staged .ts/.tsx files
- npm run lint, npm run format commands work correctly
- Subagent used: Haiku for ESLint/Prettier setup recommendations

[2026-01-08T11:57:00Z] [ITER-1] [SETUP-003] [COMPLETE] Project folder structure and reference data verified
- Directories created: src/lib/solar, src/lib/leads, src/lib/validation, src/components/{Calculator,Results,ui}, src/types
- Reference data files validated: orientation_factors.json, regional_irradiance.json, seg_tariffs.json, system_costs.json
- TypeScript types and constants scaffold already in place
- .env.example configured with all required API URLs and pricing variables

[2026-01-08T12:00:00Z] [ITER-1] [DATA-001] [COMPLETE] Postcode lookup integration with postcodes.io
- Created src/lib/solar/postcodes.ts with full API client implementation
- Official GOV.UK postcode regex (BS 7666) for format validation
- postcodes.io API integration (free, no auth required)
- localStorage caching with 7-day TTL and lazy expiry
- Exports: lookupPostcode(), validatePostcode(), normalizePostcode(), PostcodeValidator class
- Subagent used: Haiku for API research and implementation patterns

[2026-01-08T12:05:00Z] [ITER-1] [DATA-002] [COMPLETE] PVGIS API integration for solar irradiance
- Created src/lib/solar/pvgis.ts with full API client implementation
- PVGIS API endpoint: https://re.jrc.ec.europa.eu/api/PVcalc
- Supports custom tilt/azimuth parameters for different panel orientations
- 10-second request timeout with AbortController
- 24-hour localStorage caching with lazy expiry
- Automatic fallback to regional irradiance on API failure/timeout
- Exports: fetchPVGISIrradiance(), getIrradianceValue(), getMonthlyIrradiance()
- Subagent used: Haiku for PVGIS API research and implementation

[2026-01-08T12:08:00Z] [ITER-1] [DATA-003] [COMPLETE] UK energy pricing constants module verified
- src/lib/solar/constants.ts already contains all required values
- UK_ENERGY_CONFIG: Ofgem Q1 2026 rates (27.69p/kWh electricity, 15.0p/kWh SEG export)
- SYSTEM_COST_CONFIG: MCS installation cost tiers by system size
- All values have documented sources and TypeScript types

[2026-01-08T12:08:00Z] [ITER-1] [DATA-004] [COMPLETE] Reference data JSON files verified
- reference_data/orientation_factors.json: All orientations with efficiency factors
- reference_data/regional_irradiance.json: 15 UK regions with postcode prefix mapping
- reference_data/seg_tariffs.json: 10 suppliers with current SEG rates
- reference_data/system_costs.json: Cost tiers, battery storage, typical systems
- All files validated as valid JSON with fallback values defined

[2026-01-08T12:12:00Z] [ITER-1] [CALC-001..CALC-008] [COMPLETE] All calculation engine features verified
- CALC-001: calculateMaxSystemSize - 30m² returns 6.0 kWp max
- CALC-002: calculateRecommendedSize - Uses 90% of usage target
- CALC-003: calculateAnnualGeneration - Uses kWp × irradiance × factors × 0.86
- CALC-004: getMonthlyDistribution - UK solar pattern (peak June/July at 13%)
- CALC-005: calculateSelfConsumption - MCS MGD 003 ratios (always: 45%, daytime: 50%, evening: 25%)
- CALC-006: calculateAnnualSavings, calculateExportEarnings - Uses Ofgem/SEG rates
- CALC-007: calculateSystemCost (tiered), calculatePaybackPeriod, calculateROI25Years (with 0.5% degradation)
- CALC-008: calculateCO2Savings - UK grid factor 0.233 kg/kWh
- All functions already implemented in scaffold with full documentation

[2026-01-08T12:18:00Z] [ITER-1] [UI-LAND-001] [COMPLETE] Landing page hero section with CTA
- Created responsive hero section with value proposition headline
- Primary CTA button "Get Your Free Quote" links to /calculator
- Trust signals: MCS Certified Methods, PVGIS Satellite Data, Ofgem Q1 2026 Prices
- Stats section: Current rates (27.69p/kWh), SEG export (15p), payback period (7-10yr)
- Mobile-first design with Tailwind CSS, uses theme variables

[2026-01-08T12:22:00Z] [ITER-1] [UI-LAND-002] [COMPLETE] Landing page benefits and social proof
- Added "Why Use Our Solar Calculator?" benefits section with 3 benefit cards
- Added "How It Works" 3-step explanation with numbered steps
- Added secondary CTA "Start Your Calculation" button
- Added footer with branding, legal links, and data source info
- All sections responsive with mobile-first design

[2026-01-08T12:30:00Z] [ITER-1] [UI-CALC-001..005] [COMPLETE] Calculator wizard with all steps
- UI-CALC-001: Wizard container with progress bar and step navigation
- UI-CALC-002: Step 1 - Postcode input with validation via postcodes.io API
- UI-CALC-003: Step 2 - Roof details (orientation, pitch slider, area, shading)
- UI-CALC-004: Step 3 - Energy usage input with "I know my usage" vs "estimate" toggle
- UI-CALC-005: State management via useState, saved to sessionStorage for results page
- Responsive design, validation before step advancement, loading states

[2026-01-08T12:45:00Z] [ITER-1] [UI-RES-001,003] [COMPLETE] Results page with key metrics and environmental impact
- UI-RES-001: Created app/results/page.tsx with key metrics grid
  - System size (kWp), number of panels displayed prominently
  - Annual savings with breakdown (self-consumption + SEG export)
  - Payback period in years
  - Estimated system cost with installation
  - MetricCard component for consistent styling
- UI-RES-003: Environmental impact section
  - CO2 saved annually (kg) and over 25 years (tonnes)
  - Relatable comparisons: trees planted, car miles avoided
  - Visually distinct green success styling
- Mobile-first responsive design with Tailwind CSS
- Reads calculator inputs from sessionStorage
- Uses calculateSolarEstimate from calculation engine

[2026-01-08T13:00:00Z] [ITER-1] [UI-RES-002,004] [COMPLETE] Results page charts and CTAs
- UI-RES-002: Added Recharts visualisations (lightweight, React-first library)
  - MonthlyGenerationChart: Bar chart with 12 months of generation
  - SavingsBreakdownChart: Donut chart showing self-consumption vs export
  - PaybackTimelineChart: Area chart with cumulative savings and payback marker
  - All charts use dynamic imports for code splitting (ssr: false)
  - Charts are accessible with aria-label attributes
  - Responsive design using ResponsiveContainer
- UI-RES-004: CTA section for lead capture
  - "Get Free Installer Quotes" primary CTA button
  - "Download PDF Report" secondary CTA button
  - Clear value proposition explaining benefit
- Subagent used: Haiku for charting library research (recommended Recharts)

